# Caddyfile - morzz.com é…ç½®
# é¦™æ¸¯æœåŠ¡å™¨ - è‡ªåŠ¨ HTTPS
# æœ€åæ›´æ–°: $(date "+%Y-%m-%d %H:%M:%S")

# å¯¼å…¥é¢å¤–çš„é…ç½®ç‰‡æ®µ
import conf.d/*.conf

# ä¸»ç«™ç‚¹
morzz.com, www.morzz.com {
	root * /var/www/html
	file_server

	header {
		Server "Caddy"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
	}

	log {
		output file /var/log/caddy/access.log
		format json
	}
}

# API ç½‘å…³
api.morzz.com {
	respond "ğŸŒ API Gateway - Coming Soon"
}

# åº”ç”¨å…¥å£
app.morzz.com {
	respond "ğŸ“± App Portal - åº”ç”¨å…¥å£"
}

# Drone CI/CD
ci.morzz.com {
	reverse_proxy 127.0.0.1:8081

	header {
		Server "Caddy"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
	}

	log {
		output file /var/log/caddy/ci-access.log
		format json
	}
}

# Outline Wiki æ–‡æ¡£ç³»ç»Ÿ
docs.morzz.com {
	reverse_proxy 127.0.0.1:3000

	header {
		Server "Caddy"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "strict-origin-when-cross-origin"
	}

	@websockets {
		header Connection *Upgrade*
		header Upgrade websocket
	}
	reverse_proxy @websockets 127.0.0.1:3000

	log {
		output file /var/log/caddy/docs-access.log
		format json
	}
}

# Uptime Kuma ç›‘æ§é¢æ¿
status.morzz.com {
	reverse_proxy 127.0.0.1:3001

	header {
		Server "Caddy"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
	}

	log {
		output file /var/log/caddy/status-access.log
		format json
	}
}

# Vaultwarden å¯†ç ç®¡ç†å™¨
vault.morzz.com {
	reverse_proxy 127.0.0.1:8080

	header {
		Server "Caddy"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
		X-Robots-Tag "noindex, nofollow"
	}

	log {
		output file /var/log/caddy/vault-access.log
		format json
	}
}

# wiki é‡å®šå‘åˆ° docs
wiki.morzz.com {
	redir https://docs.morzz.com{uri} permanent

	log {
		output file /var/log/caddy/wiki-access.log
		format json
	}
}

# Dex OIDC è®¤è¯æœåŠ¡
auth.morzz.com {
	reverse_proxy 127.0.0.1:5556

	header {
		Server "Caddy"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
		Referrer-Policy "strict-origin-when-cross-origin"
	}

	log {
		output file /var/log/caddy/auth-access.log
		format json
	}
}

# æµ‹è¯•ç¯å¢ƒ
test.morzz.com {
	respond "ğŸ§ª Test Environment - Drone CI è‡ªåŠ¨éƒ¨ç½²æµ‹è¯• - $(date)"
}
